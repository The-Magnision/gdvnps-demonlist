---
import 'primeicons/primeicons.css'
import { supabase } from '../db/supabase'

const {} = await supabase.auth.getUser()
---

<div class="flex font-serif top-0 left-0 right-0 fixed pt-2 justify-center gap-4">
    <!--first navbar-->   
    <nav class="p-2.5 rounded-lg bg-stone-900/80 backdrop-blur-sm shadow-lg">
        <ul class="flex justify-center gap-4">
            <li><a href="/" class="hover:text-gray-400 transition-colors duration-200">Home</a></li>
            <li><a href="/demonlist" class="hover:text-gray-400 transition-colors duration-200">DemonList</a></li>
            <li><a href="/submit" class="hover:text-gray-400 transition-colors duration-200">Submit</a></li>
        </ul>
    </nav>
    <!--second navbar-->
    <div id="auth-container">
        <button 
            id="logout-btn"
            class="p-2.5 rounded-lg cursor-pointer text-black bg-white hover:bg-gray-400 transition-colors duration-200 backdrop-blur-sm shadow-lg"
            style="display: none;"
        >
            <nav>
                <ul class="flex justify-center gap-2">
                    <i class="pi pi-sign-out pt-[3.8px]" />
                    <li>Logout</li>
                </ul>
            </nav>
        </button>
        <button 
            id="login-btn"
            class="p-2.5 rounded-lg cursor-pointer text-black bg-white hover:bg-gray-400 transition-colors duration-200 backdrop-blur-sm shadow-lg"
        >
            <nav>
                <ul class="flex justify-center gap-2">
                    <i title="Login with Google" class="pi pi-google pt-[3.8px]" />
                    <li>Login</li>
                </ul>
            </nav>
        </button>
    </div>
</div>
<!--login system -->
<script>
    import { supabase } from '../db/supabase'
    
    async function updateAuthUI() {
        const { data: { user } } = await supabase.auth.getUser()
        const loginBtn = document.getElementById('login-btn')
        const logoutBtn = document.getElementById('logout-btn')

        if (user) {
            console.log('User is logged in:', user)
            if (loginBtn) loginBtn.style.display = 'none'
            if (logoutBtn) logoutBtn.style.display = 'block'
        } else {
            console.log('No user logged in')
            if (loginBtn) loginBtn.style.display = 'block'
            if (logoutBtn) logoutBtn.style.display = 'none'
        }
    }

    document.getElementById('login-btn')?.addEventListener('click', async () => {
        try {
            await supabase.auth.signInWithOAuth({
                provider: 'google',
                options: {
                    redirectTo: `${window.location.origin}/auth/callback?next=${window.location.pathname}`
                }
            })
        } catch (error) {
            console.error('Error signing in:', error)
        }
    })

    document.getElementById('logout-btn')?.addEventListener('click', async () => {
        try {
            await supabase.auth.signOut()
            window.location.href = '/'
        } catch (error) {
            console.error('Error signing out:', error)
        }
    })

    supabase.auth.onAuthStateChange((event, session) => {
        updateAuthUI()
    })

    updateAuthUI()
</script>